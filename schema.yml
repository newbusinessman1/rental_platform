openapi: 3.0.3
info:
  title: StayFinder API
  version: 1.0.0
  description: REST API для листингов, броней и отзывов
paths:
  /ads/api/bookings/:
    get:
      operationId: bookings_list
      tags:
      - bookings
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Booking'
          description: ''
    post:
      operationId: bookings_create
      tags:
      - bookings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/BookingRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
          description: ''
  /ads/api/bookings/{id}/:
    get:
      operationId: bookings_retrieve
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this booking.
        required: true
      tags:
      - bookings
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
          description: ''
    put:
      operationId: bookings_update
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this booking.
        required: true
      tags:
      - bookings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/BookingRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
          description: ''
    patch:
      operationId: bookings_partial_update
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this booking.
        required: true
      tags:
      - bookings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchedBookingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/PatchedBookingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/PatchedBookingRequest'
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
          description: ''
    delete:
      operationId: bookings_destroy
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this booking.
        required: true
      tags:
      - bookings
      security:
      - cookieAuth: []
      responses:
        '204':
          description: No response body
  /ads/api/bookings/{id}/approve/:
    post:
      operationId: bookings_approve_create
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this booking.
        required: true
      tags:
      - bookings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/BookingRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
          description: ''
  /ads/api/bookings/{id}/decline/:
    post:
      operationId: bookings_decline_create
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this booking.
        required: true
      tags:
      - bookings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/BookingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/BookingRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
          description: ''
  /ads/api/listings/:
    get:
      operationId: listings_list
      tags:
      - listings
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Listing'
          description: ''
    post:
      operationId: listings_create
      tags:
      - listings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ListingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ListingRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
          description: ''
  /ads/api/listings/{id}/:
    get:
      operationId: listings_retrieve
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this listing.
        required: true
      tags:
      - listings
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
          description: ''
    put:
      operationId: listings_update
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this listing.
        required: true
      tags:
      - listings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ListingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ListingRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
          description: ''
    patch:
      operationId: listings_partial_update
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this listing.
        required: true
      tags:
      - listings
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchedListingRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/PatchedListingRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/PatchedListingRequest'
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
          description: ''
    delete:
      operationId: listings_destroy
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this listing.
        required: true
      tags:
      - listings
      security:
      - cookieAuth: []
      responses:
        '204':
          description: No response body
  /ads/api/reviews/:
    get:
      operationId: reviews_list
      tags:
      - reviews
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Review'
          description: ''
    post:
      operationId: reviews_create
      tags:
      - reviews
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
          description: ''
  /ads/api/reviews/{id}/:
    get:
      operationId: reviews_retrieve
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this review.
        required: true
      tags:
      - reviews
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
          description: ''
    put:
      operationId: reviews_update
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this review.
        required: true
      tags:
      - reviews
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ReviewRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
          description: ''
    patch:
      operationId: reviews_partial_update
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this review.
        required: true
      tags:
      - reviews
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchedReviewRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/PatchedReviewRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/PatchedReviewRequest'
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
          description: ''
    delete:
      operationId: reviews_destroy
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this review.
        required: true
      tags:
      - reviews
      security:
      - cookieAuth: []
      responses:
        '204':
          description: No response body
  /ads/popular-listings/:
    get:
      operationId: ads_popular_listings_list
      description: Топ-10 листингов по просмотрам/отзывам
      tags:
      - ads
      security:
      - cookieAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopularListingItem'
          description: ''
  /ads/search-stats/:
    get:
      operationId: ads_search_stats_retrieve
      description: Агрегированная статистика по типам и топ-локациям
      tags:
      - ads
      security:
      - cookieAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchStats'
          description: ''
  /ads/view-history/:
    get:
      operationId: ads_view_history_list
      tags:
      - ads
      security:
      - cookieAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ViewHistoryItem'
          description: ''
components:
  schemas:
    Booking:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        listing:
          type: integer
        listing_title:
          type: string
          readOnly: true
        guest:
          type: string
          format: email
          readOnly: true
        check_in:
          type: string
          format: date
        check_out:
          type: string
          format: date
        status:
          allOf:
          - $ref: '#/components/schemas/StatusEnum'
          readOnly: true
        created_at:
          type: string
          format: date-time
          readOnly: true
      required:
      - check_in
      - check_out
      - created_at
      - guest
      - id
      - listing
      - listing_title
      - status
    BookingRequest:
      type: object
      properties:
        listing:
          type: integer
        check_in:
          type: string
          format: date
        check_out:
          type: string
          format: date
      required:
      - check_in
      - check_out
      - listing
    Listing:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        title:
          type: string
          maxLength: 255
        slug:
          type: string
          readOnly: true
          nullable: true
          pattern: ^[-a-zA-Z0-9_]+$
        description:
          type: string
        location:
          type: string
          nullable: true
          maxLength: 255
        price_per_night:
          type: string
          format: decimal
          pattern: ^-?\d{0,8}(?:\.\d{0,2})?$
          nullable: true
        owner_email:
          type: string
          format: email
          readOnly: true
        created_at:
          type: string
          format: date-time
          readOnly: true
          nullable: true
        reviews_count:
          type: integer
          readOnly: true
        avg_rating:
          type: number
          format: double
          readOnly: true
      required:
      - avg_rating
      - created_at
      - id
      - owner_email
      - reviews_count
      - slug
      - title
    ListingRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
        location:
          type: string
          nullable: true
          maxLength: 255
        price_per_night:
          type: string
          format: decimal
          pattern: ^-?\d{0,8}(?:\.\d{0,2})?$
          nullable: true
      required:
      - title
    LocationCount:
      type: object
      properties:
        location:
          type: string
          nullable: true
        cnt:
          type: integer
      required:
      - cnt
      - location
    PatchedBookingRequest:
      type: object
      properties:
        listing:
          type: integer
        check_in:
          type: string
          format: date
        check_out:
          type: string
          format: date
    PatchedListingRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
        location:
          type: string
          nullable: true
          maxLength: 255
        price_per_night:
          type: string
          format: decimal
          pattern: ^-?\d{0,8}(?:\.\d{0,2})?$
          nullable: true
    PatchedReviewRequest:
      type: object
      properties:
        listing:
          type: integer
        rating:
          type: integer
          maximum: 2147483647
          minimum: -2147483648
        comment:
          type: string
          minLength: 1
    PopularListingItem:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        slug:
          type: string
        location:
          type: string
          nullable: true
        price_per_night:
          type: string
          format: decimal
          pattern: ^-?\d{0,8}(?:\.\d{0,2})?$
        views_count:
          type: integer
        reviews_count:
          type: integer
        avg_rating:
          type: number
          format: double
          nullable: true
      required:
      - avg_rating
      - id
      - location
      - price_per_night
      - reviews_count
      - slug
      - title
      - views_count
    Review:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        listing:
          type: integer
        user_email:
          type: string
          readOnly: true
        rating:
          type: integer
          maximum: 2147483647
          minimum: -2147483648
        comment:
          type: string
        created_at:
          type: string
          format: date-time
          readOnly: true
      required:
      - comment
      - created_at
      - id
      - listing
      - rating
      - user_email
    ReviewRequest:
      type: object
      properties:
        listing:
          type: integer
        rating:
          type: integer
          maximum: 2147483647
          minimum: -2147483648
        comment:
          type: string
          minLength: 1
      required:
      - comment
      - listing
      - rating
    SearchStats:
      type: object
      properties:
        by_type:
          type: array
          items:
            $ref: '#/components/schemas/TypeCount'
        top_locations:
          type: array
          items:
            $ref: '#/components/schemas/LocationCount'
      required:
      - by_type
      - top_locations
    StatusEnum:
      enum:
      - pending
      - approved
      - declined
      - finished
      type: string
      description: |-
        * `pending` - Pending
        * `approved` - Approved
        * `declined` - Declined
        * `finished` - Finished
    TypeCount:
      type: object
      properties:
        type:
          type: string
        cnt:
          type: integer
      required:
      - cnt
      - type
    ViewHistoryItem:
      type: object
      properties:
        listing:
          type: string
        listing_id:
          type: integer
        user:
          type: string
          nullable: true
        ip:
          type: string
          nullable: true
        when:
          type: string
          format: date-time
      required:
      - ip
      - listing
      - listing_id
      - user
      - when
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: sessionid

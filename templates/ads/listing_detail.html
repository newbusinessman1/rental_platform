{% extends "base.html" %}

{% block title %}{{ listing.title }} ‚Äî StayFinder{% endblock %}

{# –ø–æ–¥–∫–ª—é—á–∏–º CSS flatpickr #}
{% block extra_head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-12">
  <h1 class="text-4xl font-bold mb-2">{{ listing.title }}</h1>

  {% if listing.cover_image %}
    <img src="{{ listing.cover_image.url }}" alt="{{ listing.title }}" class="rounded-lg shadow mb-6">
  {% endif %}

  <p class="text-gray-700 mb-3">{{ listing.description }}</p>
  <p class="text-gray-600 flex items-center gap-2 mb-1">üìç {{ listing.location }}</p>
  <p class="text-gray-800 font-semibold mb-8">üí∞ {{ listing.price_per_night }} ‚Ç¨ / –Ω–æ—á—å</p>

  {# --- –ë–†–û–ù–ò–†–û–í–ê–ù–ò–ï --- #}
  {% if user.is_authenticated and user.email and listing.owner_email and user.email|lower == listing.owner_email|lower %}
    <div class="p-4 border rounded bg-yellow-50 text-yellow-900">
      –≠—Ç–æ –≤–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ. –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –Ω–µ–ª—å–∑—è.
    </div>
  {% else %}
    <h2 class="text-2xl font-semibold mb-4">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</h2>

    {% if user.is_authenticated %}
      <form method="post" action="{% url 'ads:booking_create' slug=listing.slug %}" class="bg-white p-6 rounded-xl shadow space-y-4">
        {% csrf_token %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm text-gray-700 mb-2">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞</label>
            {{ booking_form.check_in }}
            {% if booking_form.check_in.errors %}
              <p class="text-sm text-red-600 mt-1">{{ booking_form.check_in.errors.0 }}</p>
            {% endif %}
          </div>

          <div>
            <label class="block text-sm text-gray-700 mb-2">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞</label>
            {{ booking_form.check_out }}
            {% if booking_form.check_out.errors %}
              <p class="text-sm text-red-600 mt-1">{{ booking_form.check_out.errors.0 }}</p>
            {% endif %}
          </div>
        </div>

        <button type="submit"
                class="bg-pink-600 text-white px-5 py-3 rounded-lg hover:bg-pink-700 transition">
          –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
        </button>
      </form>
    {% else %}
      <div class="bg-yellow-50 border border-yellow-200 text-yellow-900 p-4 rounded mb-4">
        –ß—Ç–æ–±—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.
      </div>
      <a href="{% url 'users:login' %}?next={{ request.path }}"
         class="inline-block bg-pink-600 text-white px-5 py-3 rounded-lg hover:bg-pink-700 transition">
        –í–æ–π—Ç–∏ –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
      </a>
    {% endif %}
  {% endif %}
</div>
{% endblock %}

{# JS flatpickr + –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è #}
{% block extra_scripts %}
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Å–µ–≥–æ–¥–Ω—è, –∫—Ä–∞—Å–∏–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞/–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    flatpickr(".datepicker", {
      minDate: "today",
      dateFormat: "Y-m-d",     // —Ñ–æ—Ä–º–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π Django –ø–æ–Ω–∏–º–∞–µ—Ç –∫–∞–∫ YYYY-MM-DD
      altInput: true,
      altFormat: "d.m.Y",      // –∫—Ä–∞—Å–∏–≤—ã–π –≤–∏–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    });
  </script>
{% endblock %}

